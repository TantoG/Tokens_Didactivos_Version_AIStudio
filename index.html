<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Guía Didáctica de Tokens</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Babel Standalone -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
      body {
        font-family: 'Inter', sans-serif;
        background-color: #020617; /* slate-950 */
        color: #f8fafc; /* slate-50 */
      }
      /* Custom scrollbar */
      ::-webkit-scrollbar { width: 8px; height: 8px; }
      ::-webkit-scrollbar-track { background: #0f172a; }
      ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
      ::-webkit-scrollbar-thumb:hover { background: #475569; }
      
      .animate-fade-in { animation: fadeIn 0.5s ease-in-out; }
      @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>

    <!-- Import Map: Updated URLs to ensure availability -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "recharts": "https://esm.sh/recharts@2.12.3?deps=react@18.2.0,react-dom@18.2.0",
        "lucide-react": "https://esm.sh/lucide-react@0.344.0?deps=react@18.2.0",
        "@google/genai": "https://esm.sh/@google/genai"
      }
    }
    </script>

    <script>
      // Polyfill simple para process.env
      window.process = { env: { API_KEY: '' } };
    </script>
  </head>
  <body>
    <div id="root"></div>

    <!-- Application Code -->
    <script type="text/babel" data-type="module" data-presets="env,react">
      import React, { useState, useEffect } from 'react';
      import ReactDOM from 'react-dom/client';
      import { 
        BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Cell 
      } from 'recharts';
      import { 
        BookOpen, Scale, Languages, ChartColumn, 
        RefreshCw, Info, ArrowRightLeft, Loader2, 
        Coins, Cpu, Database, Video, Box 
      } from 'lucide-react';
      import { GoogleGenAI } from "@google/genai";

      // --- CONFIGURATION & CONSTANTS ---
      const GEMINI_MODEL = 'gemini-3-flash-preview';
      
      const STAGES = [
        { id: 'anatomy', title: '1. Anatomía', subtitle: '¿Qué es un Token?', icon: Scale },
        { id: 'inequity', title: '2. Inequidad', subtitle: 'Sesgo del Idioma', icon: Languages },
        { id: 'asymmetry', title: '3. Asimetría', subtitle: 'Entrada vs Salida', icon: ChartColumn }
      ];

      // --- SERVICES ---
      // Initialized with empty key for demo; in production, this needs a valid key.
      const ai = new GoogleGenAI({ apiKey: process.env.API_KEY || 'demo-key' });

      // --- COMPONENTS ---

      // 1. ANATOMY COMPONENT
      const Stage1Anatomy = () => {
        const [text, setText] = useState("El arte digital requiere tokens");
        const [tokens, setTokens] = useState({ word: [], char: [], bpe: [] });

        useEffect(() => {
          // Simulation logic
          const word = text.split(/(\s+|[.,;!?])/).filter(t => t.trim().length > 0);
          
          const char = [];
          for (let i = 0; i < text.length; i += 4) char.push(text.slice(i, i + 4));
          
          // Simplified BPE simulation
          const bpe = [];
          text.split(' ').forEach(w => {
            if (w.length > 5) {
               const m = Math.floor(w.length/2); 
               bpe.push(w.slice(0, m)); 
               bpe.push(w.slice(m)); 
            } else { bpe.push(w); }
          });

          setTokens({ word, char, bpe });
        }, [text]);

        const Card = ({ title, data, color, recom }) => (
          <div className={`bg-slate-900 rounded-xl border ${recom ? 'border-green-500/50 ring-1 ring-green-500/30' : 'border-slate-800'} p-4 flex flex-col h-full`}>
            <div className="flex justify-between items-start mb-3">
              <h3 className="font-bold text-slate-200">{title}</h3>
              {recom && <span className="bg-green-900/50 text-green-300 text-[10px] px-2 py-0.5 rounded uppercase font-bold">Estándar</span>}
            </div>
            <div className="flex-1 flex flex-wrap gap-1 content-start mb-4">
              {data.map((t, i) => (
                <span key={i} className={`px-2 py-1 rounded text-xs font-mono border ${color} bg-opacity-20`}>{t}</span>
              ))}
            </div>
            <div className="text-right text-xs text-slate-500 font-mono border-t border-slate-800 pt-2">
              Count: <span className="text-white font-bold">{data.length}</span>
            </div>
          </div>
        );

        return (
          <div className="animate-fade-in space-y-6">
            <div className="bg-slate-900 p-6 rounded-xl border border-slate-800">
              <label className="text-slate-400 text-sm mb-2 block">Prueba el Tokenizador:</label>
              <textarea 
                value={text} onChange={e => setText(e.target.value)}
                className="w-full bg-slate-950 border border-slate-700 rounded-lg p-3 text-slate-200 focus:ring-2 focus:ring-indigo-500 outline-none h-24 font-mono"
              />
            </div>
            <div className="grid md:grid-cols-3 gap-4">
              <Card title="Palabra Completa" data={tokens.word} color="border-red-500/30 bg-red-500/10 text-red-200" />
              <Card title="Caracteres (4)" data={tokens.char} color="border-yellow-500/30 bg-yellow-500/10 text-yellow-200" />
              <Card title="Sub-palabra (BPE)" data={tokens.bpe} color="border-green-500/30 bg-green-500/10 text-green-200" recom />
            </div>
             <div className="bg-blue-900/20 border-l-4 border-blue-500 p-4 rounded text-blue-200 text-sm">
                <Info className="inline w-4 h-4 mr-2"/>
                Los LLMs modernos usan <strong>BPE</strong>. Es el equilibrio perfecto entre vocabulario manejable y capacidad de entender palabras nuevas.
             </div>
          </div>
        );
      };

      // 2. INEQUITY COMPONENT
      const Stage2Inequity = () => {
        const [loading, setLoading] = useState(false);
        const [data, setData] = useState([
          { lang: 'Inglés', tokens: 15, fill: '#6366f1' },
          { lang: 'Español', tokens: 20, fill: '#f43f5e' },
          { lang: 'Chino', tokens: 12, fill: '#10b981' }
        ]);

        const simulate = async () => {
          setLoading(true);
          await new Promise(r => setTimeout(r, 1000));
          const base = Math.floor(Math.random() * 5) + 15;
          setData([
             { lang: 'Inglés', tokens: base, fill: '#6366f1' },
             { lang: 'Español', tokens: Math.floor(base * 1.3), fill: '#f43f5e' }, 
             { lang: 'Chino', tokens: Math.floor(base * 0.8), fill: '#10b981' }   
          ]);
          setLoading(false);
        };

        return (
          <div className="animate-fade-in grid lg:grid-cols-2 gap-8">
            <div className="space-y-6">
              <div className="bg-slate-900 p-6 rounded-xl border border-slate-800">
                <h3 className="text-xl font-bold text-slate-100 mb-4">La "Multa" del Idioma</h3>
                <p className="text-slate-400 mb-6">El español consume más tokens que el inglés para decir lo mismo.</p>
                <button 
                  onClick={simulate} 
                  disabled={loading}
                  className="w-full bg-indigo-600 hover:bg-indigo-500 text-white py-3 rounded-lg font-bold flex justify-center items-center transition"
                >
                  {loading ? <Loader2 className="animate-spin mr-2"/> : <RefreshCw className="mr-2"/>}
                  Simular Costo Comparativo
                </button>
              </div>
              <div className="grid grid-cols-2 gap-4 text-center">
                <div className="bg-slate-800 p-4 rounded-lg">
                  <div className="text-red-400 font-bold text-2xl">+30%</div>
                  <div className="text-xs text-slate-500 uppercase">Sobrecosto Español</div>
                </div>
                <div className="bg-slate-800 p-4 rounded-lg">
                  <div className="text-green-400 font-bold text-2xl">-20%</div>
                  <div className="text-xs text-slate-500 uppercase">Eficiencia Chino</div>
                </div>
              </div>
            </div>
            
            <div className="bg-slate-900 p-4 rounded-xl border border-slate-800 h-80">
              <ResponsiveContainer width="100%" height="100%">
                <BarChart data={data} layout="vertical">
                  <CartesianGrid strokeDasharray="3 3" horizontal={false} stroke="#334155" />
                  <XAxis type="number" hide />
                  <YAxis dataKey="lang" type="category" width={60} stroke="#94a3b8" fontSize={12} />
                  <Tooltip cursor={{fill: 'transparent'}} contentStyle={{background: '#1e293b', border: 'none', color:'#fff'}} />
                  <Bar dataKey="tokens" radius={[0, 4, 4, 0]} barSize={40} />
                </BarChart>
              </ResponsiveContainer>
            </div>
          </div>
        );
      };

      // 3. ASYMMETRY COMPONENT
      const Stage3Asymmetry = () => {
        const [input, setInput] = useState(1000);
        const [output, setOutput] = useState(100);
        
        const costIn = input * 0.0001; 
        const costOut = output * 0.0004; 
        const total = costIn + costOut;

        return (
          <div className="animate-fade-in space-y-8">
            <div className="bg-gradient-to-r from-indigo-900 to-slate-900 p-8 rounded-2xl border border-indigo-500/30 relative overflow-hidden">
               <div className="relative z-10">
                 <h2 className="text-2xl font-bold text-white mb-2">Entrada vs. Salida</h2>
                 <p className="text-indigo-200 max-w-lg">
                   Generar texto (output) es computacionalmente mucho más caro que leerlo (input).
                 </p>
               </div>
               <Video className="absolute right-4 bottom-4 w-32 h-32 text-indigo-500/10" />
            </div>

            <div className="grid md:grid-cols-2 gap-8 bg-slate-900 p-6 rounded-xl border border-slate-800">
               <div className="space-y-6">
                 <div>
                   <label className="flex justify-between text-sm text-slate-400 mb-2">
                     Tokens de Entrada (Prompt) <span className="text-white">{input}</span>
                   </label>
                   <input type="range" min="100" max="5000" step="100" value={input} onChange={e=>setInput(Number(e.target.value))} className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-sky-500"/>
                 </div>
                 <div>
                   <label className="flex justify-between text-sm text-slate-400 mb-2">
                     Tokens de Salida (Generación) <span className="text-white">{output}</span>
                   </label>
                   <input type="range" min="10" max="1000" step="10" value={output} onChange={e=>setOutput(Number(e.target.value))} className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-rose-500"/>
                 </div>
               </div>

               <div className="flex flex-col justify-center space-y-4">
                  <div className="flex items-center justify-between p-3 bg-slate-800/50 rounded border border-slate-700">
                    <div className="flex items-center text-sky-400"><Cpu size={16} className="mr-2"/> Entrada</div>
                    <div className="font-mono text-white">${costIn.toFixed(4)}</div>
                  </div>
                  <div className="flex items-center justify-between p-3 bg-slate-800/50 rounded border border-slate-700">
                    <div className="flex items-center text-rose-400"><Database size={16} className="mr-2"/> Salida</div>
                    <div className="font-mono text-white">${costOut.toFixed(4)}</div>
                  </div>
                  <div className="border-t border-slate-700 pt-3 flex justify-between items-center">
                    <span className="text-slate-400 uppercase text-xs font-bold">Costo Total</span>
                    <span className="text-2xl font-bold text-white">${total.toFixed(4)}</span>
                  </div>
               </div>
            </div>
          </div>
        );
      };

      // MAIN APP SHELL
      const App = () => {
        const [stage, setStage] = useState('anatomy');

        return (
          <div className="flex flex-col md:flex-row min-h-screen">
            <aside className="w-full md:w-72 bg-slate-900 border-r border-slate-800 flex flex-col md:h-screen sticky top-0 z-20">
              <div className="p-6 flex items-center border-b border-slate-800">
                <div className="bg-indigo-600 p-2 rounded-lg text-white mr-3 shadow-lg shadow-indigo-500/20">
                  <BookOpen size={20} />
                </div>
                <div>
                  <h1 className="font-bold text-slate-100">Tokens 101</h1>
                  <p className="text-xs text-slate-500">Guía Interactiva</p>
                </div>
              </div>
              <nav className="flex-1 p-4 space-y-2 overflow-y-auto">
                {STAGES.map(s => (
                  <button 
                    key={s.id} 
                    onClick={() => setStage(s.id)}
                    className={`w-full flex items-center p-3 rounded-lg text-left transition ${stage === s.id ? 'bg-indigo-900/20 text-indigo-300 border border-indigo-500/30' : 'text-slate-400 hover:bg-slate-800 hover:text-slate-200 border border-transparent'}`}
                  >
                    <s.icon size={18} className="mr-3 opacity-70" />
                    <div>
                      <div className="text-sm font-semibold">{s.title}</div>
                      <div className="text-[10px] opacity-60">{s.subtitle}</div>
                    </div>
                  </button>
                ))}
              </nav>
            </aside>
            <main className="flex-1 bg-slate-950 p-4 md:p-8 lg:p-12 overflow-y-auto h-screen">
              <div className="max-w-4xl mx-auto">
                {stage === 'anatomy' && <Stage1Anatomy />}
                {stage === 'inequity' && <Stage2Inequity />}
                {stage === 'asymmetry' && <Stage3Asymmetry />}
              </div>
            </main>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>